# Manual Script-Based Upload Guide

## 🛠️ Alternative Upload Method (Advanced Users)

### Overview
This guide covers the manual, script-based upload process for advanced users who prefer command-line operations or need batch processing outside the web interface.

**Note**: This is an alternative to the main web-based admin pipeline. Most users should use the web interface at `/admin/upload`.

---

## 📁 Directory Structure

### Local File Organization
```
public/stickers/
├── source/          # 🎯 Place your original stickers here
│   ├── happy-emoji.jpg
│   ├── funny-face.png
│   ├── reaction-sticker.gif
│   └── ...
├── webp/           # ⚙️ Generated by optimize script
│   ├── happy-emoji.webp
│   ├── funny-face.webp
│   └── ...
└── metadata/       # 📝 Auto-generated during processing
    └── sticker-metadata.json
```

### Supabase Storage Result
```
stickers/
├── happy-emoji.webp    # Mobile format
├── happy-emoji.png     # Desktop/WhatsApp format
├── funny-face.webp
├── funny-face.png
└── ...
```

---

## 🔧 Available Scripts

### 1. Sticker Optimization
```bash
npm run optimize-stickers
```

**What it does**:
- Reads all files from `public/stickers/source/`
- Converts to 512x512px WebP format
- Optimizes for web delivery (quality: 80)
- Preserves transparency where applicable
- Outputs to `public/stickers/webp/`
- Generates metadata file with sticker information

**File**: `scripts/download-and-optimize.js`

### 2. Upload to Database
```bash
npm run upload-stickers
```

**What it does**:
- Reads optimized WebP files from `webp/` directory
- Uploads files to Supabase Storage (`stickers` bucket)
- Creates database records with metadata
- Generates PNG versions for WhatsApp compatibility
- Updates download counts and availability status

**File**: `scripts/upload-to-supabase-admin.js`

### 3. WebP to PNG Conversion
```bash
npm run convert-webp-to-png
```

**What it does**:
- Downloads WebP files from Supabase Storage
- Converts to PNG format (for desktop/WhatsApp compatibility)
- Uploads PNG versions back to storage
- Updates database records with PNG URLs

**File**: `scripts/convert-webp-to-png.js`

---

## 📝 Step-by-Step Manual Process

### Step 1: Prepare Source Files

1. **Collect Stickers**:
   - Gather high-quality sticker images
   - Preferred formats: PNG (transparent), JPG, WebP, SVG
   - Recommended size: 512x512px or larger
   - Ensure appropriate content (family-friendly)

2. **File Naming**:
   - Use descriptive filenames: `happy-emoji.png`, `thumbs-up.jpg`
   - Avoid spaces and special characters
   - Use hyphens for word separation

3. **Place in Source Directory**:
   ```bash
   cp /path/to/your/stickers/* public/stickers/source/
   ```

### Step 2: Run Optimization

```bash
# Navigate to project root
cd /path/to/funny-yellow

# Run optimization script
npm run optimize-stickers
```

**Expected Output**:
```
Processing stickers...
✅ happy-emoji.jpg → happy-emoji.webp (512x512)
✅ funny-face.png → funny-face.webp (512x512)  
✅ Generated metadata for 2 stickers
📁 Files saved to public/stickers/webp/
```

### Step 3: Upload to Production

```bash
# Upload optimized stickers to Supabase
npm run upload-stickers
```

**Expected Output**:
```
Uploading stickers to Supabase...
✅ happy-emoji.webp → stickers/happy-emoji.webp
✅ Database record created: happy-emoji (ID: abc123)
✅ funny-face.webp → stickers/funny-face.webp  
✅ Database record created: funny-face (ID: def456)
📊 Successfully uploaded 2 stickers
```

### Step 4: Generate PNG Versions

```bash
# Create PNG versions for WhatsApp compatibility
npm run convert-webp-to-png
```

**Expected Output**:
```
Converting WebP to PNG...
✅ happy-emoji.webp → happy-emoji.png
✅ funny-face.webp → funny-face.png
📱 PNG versions available for WhatsApp
```

### Step 5: Verification

1. **Check Gallery**: Visit `http://localhost:3000` to see new stickers
2. **Test Downloads**: Verify both WebP and PNG versions download
3. **Mobile Test**: Check mobile responsiveness and WebP delivery
4. **WhatsApp Test**: Confirm PNG versions work in WhatsApp Web

---

## ⚙️ Script Configuration

### Environment Variables
```env
# Required in .env.local
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Optional configuration
MAX_BATCH_SIZE=20          # Max files per batch
WEBP_QUALITY=80           # WebP compression quality (0-100)
TARGET_SIZE=512           # Target image size (pixels)
```

### Metadata Customization

Edit `scripts/sticker-metadata.json` before upload:

```json
{
  "happy-emoji.webp": {
    "name": "Happy Emoji",
    "tags": ["happy", "emoji", "smile", "positive"],
    "category": "emotions"
  },
  "funny-face.webp": {
    "name": "Funny Face",
    "tags": ["funny", "face", "comedy", "laugh"],
    "category": "humor"
  }
}
```

---

## 🚨 Troubleshooting

### Common Issues

#### Script Execution Fails
```bash
Error: Command not found
```
**Solution**: Ensure you're in the project root directory and dependencies are installed:
```bash
npm install
```

#### Image Processing Errors
```bash
Error: Sharp processing failed
```
**Solutions**:
- Install Sharp dependency: `npm install sharp`
- Check source file integrity (files not corrupted)
- Verify file formats are supported (JPG, PNG, WebP, SVG)

#### Supabase Upload Fails
```bash
Error: 401 Unauthorized
```
**Solutions**:
- Check SUPABASE_SERVICE_ROLE_KEY in `.env.local`
- Verify Supabase project URL is correct
- Ensure service role key has admin permissions

#### Database Insertion Errors
```bash
Error: Unique constraint violation
```
**Solutions**:
- Check for duplicate filenames in source directory
- Clear existing records if needed (be careful!)
- Use unique filenames for new stickers

### Performance Issues

#### Large File Processing
- Process files in smaller batches (max 20 at a time)
- Ensure sufficient disk space for temporary files
- Monitor memory usage during processing

#### Network Timeouts
- Check internet connection stability
- Retry failed uploads individually
- Consider processing during off-peak hours

---

## 📊 Batch Processing Tips

### Efficient Workflow

1. **Prepare in Batches**: Group similar stickers together
2. **Test First**: Process 1-2 stickers before large batches
3. **Backup Source**: Keep original files safe
4. **Monitor Logs**: Watch console output for errors
5. **Verify Results**: Check each batch in the gallery

### Quality Control

#### Pre-Upload Checklist
- [ ] All files are high quality (minimal compression artifacts)
- [ ] Transparent backgrounds where appropriate
- [ ] Consistent naming convention
- [ ] Appropriate content (no copyrighted material)
- [ ] File sizes reasonable (< 5MB each)

#### Post-Upload Verification
- [ ] Stickers appear in gallery immediately
- [ ] Download functionality works (both formats)
- [ ] Search and filtering includes new stickers
- [ ] Mobile and desktop compatibility confirmed
- [ ] WhatsApp Web compatibility verified

---

## 🔄 Migration from Scripts to Web Interface

### Why Consider Web Interface?
- **No terminal knowledge required**
- **Real-time progress visualization** 
- **Better error handling and recovery**
- **Integrated metadata editing**
- **Atomic processing (all-or-nothing)**

### When to Use Scripts?
- **Batch processing large collections**
- **Automated workflows or CI/CD integration**
- **Advanced users comfortable with command line**
- **Custom processing requirements**

### Transitioning
The web interface at `/admin/upload` provides the same functionality with enhanced UX. Scripts remain available for advanced use cases.

---

## 📚 Script Documentation

### Core Scripts Location
- **Optimization**: `scripts/download-and-optimize.js`
- **Upload**: `scripts/upload-to-supabase-admin.js`
- **Conversion**: `scripts/convert-webp-to-png.js`
- **Metadata**: `scripts/generate-sticker-metadata.js`

### Dependencies
```json
{
  "sharp": "^0.33.5",        // Image processing
  "@supabase/supabase-js": "^2.55.0",  // Database & storage
  "dotenv": "^17.2.1",       // Environment variables
  "jszip": "^3.10.1"         // Archive handling
}
```

---

**Status**: ✅ Maintained (Legacy Support)  
**Recommendation**: Use web interface at `/admin/upload` for better UX  
**Last Updated**: January 2025